
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Important changes in Soma-Workflow 3 &#8212; soma-workflow version 3.3 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    
    <link rel="icon" href="_static/icon_small.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Graphical User Interface" href="gui.html" />
    <link rel="prev" title="Soma-workflow concepts" href="concepts.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="gui.html" title="Graphical User Interface"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="concepts.html" title="Soma-workflow concepts"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">soma-workflow version 3.3 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Important changes in Soma-Workflow 3</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="important-changes-in-soma-workflow-3">
<span id="changes-3"></span><h1>Important changes in Soma-Workflow 3<a class="headerlink" href="#important-changes-in-soma-workflow-3" title="Permalink to this heading">¶</a></h1>
<nav class="contents local" id="soma-workflow-changes-in-3">
<p class="topic-title">Soma-workflow changes in 3</p>
<ul class="simple">
<li><p><a class="reference internal" href="#important-changes-in-soma-workflow-3-1" id="id2">Important changes in Soma-Workflow 3.1</a></p>
<ul>
<li><p><a class="reference internal" href="#client-server-communication" id="id3">Client-server communication</a></p></li>
<li><p><a class="reference internal" href="#dynamic-parameters-in-workflows" id="id4">Dynamic parameters in workflows</a></p></li>
<li><p><a class="reference internal" href="#jobs-parameters-as-files" id="id5">Jobs parameters as files</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#important-changes-in-soma-workflow-3-0" id="id6">Important changes in Soma-Workflow 3.0</a></p>
<ul>
<li><p><a class="reference internal" href="#id1" id="id7">Client-server communication</a></p></li>
<li><p><a class="reference internal" href="#python-2-and-python-3" id="id8">Python 2 and Python 3</a></p>
<ul>
<li><p><a class="reference internal" href="#client-and-server-should-use-the-same-python-version" id="id9">Client and server should use the same Python version</a></p></li>
<li><p><a class="reference internal" href="#playing-with-both-python-versions-at-the-same-time" id="id10">Playing with both python versions at the same time</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<section id="important-changes-in-soma-workflow-3-1">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Important changes in Soma-Workflow 3.1</a><a class="headerlink" href="#important-changes-in-soma-workflow-3-1" title="Permalink to this heading">¶</a></h2>
<p>Database format has moved to version 3.0</p>
<section id="client-server-communication">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Client-server communication</a><a class="headerlink" href="#client-server-communication" title="Permalink to this heading">¶</a></h3>
<p>The communication protocol in client / server mode (now based on ZMQ since 3.0) has been modified to handle multi-threaded, asynchronous requests, and avoid deadlocks. Disconnections are detected at several places and both client and server stopped when this occurs.</p>
</section>
<section id="dynamic-parameters-in-workflows">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Dynamic parameters in workflows</a><a class="headerlink" href="#dynamic-parameters-in-workflows" title="Permalink to this heading">¶</a></h3>
<p>Jobs may have “named parameters”: a dictionary of parameters, which will be used to build the actual commandline, or pass parameters via a JSON file.</p>
<p>Jobs may have “output parameters”: also a dictionary of parameters, which may be written during a job execution as a JSON file, and which can be linked to input parameters of downstream jobs.</p>
<p>Thus workflows may contain some “parameters links” to specify this. Links can transform values to implement map/reduce or cross-validation pattens.</p>
<p>See the details in the <a class="reference internal" href="workflow_creation.html#dynamic-outputs"><span class="std std-ref">Dynamic output parameters values in Soma-Workflow</span></a> section.</p>
</section>
<section id="jobs-parameters-as-files">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Jobs parameters as files</a><a class="headerlink" href="#jobs-parameters-as-files" title="Permalink to this heading">¶</a></h3>
<p>As Soma-Workflow now supports named parameters, the parameters set of a job may also be specified in an input JSON file, rather than on commandline arguments. This may prove useful when the parameters list is long.</p>
<p>See the details in the <a class="reference internal" href="workflow_creation.html#input-params-file"><span class="std std-ref">Job input parameters as file</span></a> section.</p>
</section>
</section>
<section id="important-changes-in-soma-workflow-3-0">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Important changes in Soma-Workflow 3.0</a><a class="headerlink" href="#important-changes-in-soma-workflow-3-0" title="Permalink to this heading">¶</a></h2>
<section id="id1">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Client-server communication</a><a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h3>
<p>In Soma-Workflow 2 (and earlier), the client-server communication was using Pyro3 inside a SSH tunnel. Pyro3 is a python library for remote objects control, which has many advantages but also two important drawbacks:</p>
<ul class="simple">
<li><p>It is a bit overkill for what we are doing: Pyro is using a “name server”, a server process which has to run somewhere on a network to address objects to remote hosts. This name server is not needed in our application.</p></li>
<li><p>Pyro3 has not been ported to Python 3.</p></li>
</ul>
<p>We could have switched to Pyro4, but decided that we could use <a class="reference external" href="http://zeromq.org/">ZMQ</a> instead. So we did. Soma-Workflow 3 communications are now based on ZMQ (still through a SSH tunnel).</p>
<p>As a consequence, the communication protocol is completely different from what it used to be, and is incompatible (this would also be incompatible using Pyro4). The database format has also changed, so Soma-Workflow 3 cannot be used to recover workflows created with version 2. Older servers have to be shut down before SWF 3 is used. Note that shutting down servers can be done via the graphical interface in <code class="docutils literal notranslate"><span class="pre">soma_workflow_gui</span></code> when connecting to a remote computing resource, but SWF3 has te be installed on the resource.</p>
</section>
<section id="python-2-and-python-3">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Python 2 and Python 3</a><a class="headerlink" href="#python-2-and-python-3" title="Permalink to this heading">¶</a></h3>
<p>Soma-Workflow 2 could only run using Python 2. The removal of Pyro3 has allowed to port to Python 3. Soma-Workflow 3 can be run using either Python 2 and 3.</p>
<p>However SWF is using in its communications and database some picked objects, which could not be made compatible between python2 and 3, so if one now have the choice of python version, he has to be consistent with this choice:</p>
<section id="client-and-server-should-use-the-same-python-version">
<h4><a class="toc-backref" href="#id9" role="doc-backlink">Client and server should use the same Python version</a><a class="headerlink" href="#client-and-server-should-use-the-same-python-version" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>Both ends of the communication should use the same python version (2 or 3). Connections made by the client normally ensure that the servers are run using the same version of Python.</p></li>
<li><p>But the same version of python thus has to be installed on both client and server machines. Of course both versions can be installed.</p></li>
<li><p>Moreover if a server is run once using a given version of python, all client connections have to be made using the same version of python. A clear error message will be issued in case of mismatch.</p></li>
</ul>
</section>
<section id="playing-with-both-python-versions-at-the-same-time">
<h4><a class="toc-backref" href="#id10" role="doc-backlink">Playing with both python versions at the same time</a><a class="headerlink" href="#playing-with-both-python-versions-at-the-same-time" title="Permalink to this heading">¶</a></h4>
<p>If python version has to be switched for any reason, then the servers have to be killed, and the database erased.</p>
<p>However it is possible to setup two computing resources configurations, to be used one for python2 and one for python3. Both can run on the same physical server. They should specify different files and directories for database, log files, file transfers etc. They will thus not share the same workflows and will look totally independent, even if running on the same machine or cluster.</p>
<p>Both servers can run on the same machine at the same time: the client will take care of taking to the right one (which was not done in previous versions of SWF). Note however that the “kill servers” option in the connection dialog in the GUI will kill all of them.</p>
<p>On a local machine, it is also possible to use two different configurations. But one of them will not be the default one, so you will have to specify it (when running <code class="docutils literal notranslate"><span class="pre">soma_workflow_gui</span></code> or connecting via the client API). The configuration has to be created “by hand” in the config file (<code class="docutils literal notranslate"><span class="pre">$HOME/.soma-workflow.cfg</span></code> by default), and must specify that it is a “light mode’ server with a <code class="docutils literal notranslate"><span class="pre">local_basic</span></code> scheduler.</p>
<p>Moreover a new configuration option <code class="docutils literal notranslate"><span class="pre">ALLOWED_PYTHON_VERSIONS</span></code> (on client side) allows to mark some resources with some versions of python. Non-matching versions will be discarded, and will not be displayed in the GUI. Connection to the default local resource will also try to use a matching one.</p>
<p>Ex:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[localmachine-py3]</span>
<span class="na">database_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">/home/someone/.soma-workflow/py3/soma_workflow.db</span>
<span class="na">path_translation_files</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">brainvisa{/home/someone/.brainvisa/soma-workflow.translation}</span>
<span class="na">engine_log_dir</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s">/home/someone/.soma-workflow/py3/logs/is234199</span>
<span class="na">engine_log_level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">ERROR</span>
<span class="na">server_log_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">/home/someone/.soma-workflow/py3/logs/is234199/server_log</span>
<span class="na">server_log_level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">ERROR</span>
<span class="na">transfered_files_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">/home/someone/.soma-workflow/py3/transfered_files</span>
<span class="na">light_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1</span>
<span class="na">scheduler_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">local_basic</span>
<span class="na">allowed_python_versions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">3</span>
</pre></div>
</div>
</section>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo_white_small.png" alt="Logo"/>
            </a></p>
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Important changes in Soma-Workflow 3</a><ul>
<li><a class="reference internal" href="#important-changes-in-soma-workflow-3-1">Important changes in Soma-Workflow 3.1</a><ul>
<li><a class="reference internal" href="#client-server-communication">Client-server communication</a></li>
<li><a class="reference internal" href="#dynamic-parameters-in-workflows">Dynamic parameters in workflows</a></li>
<li><a class="reference internal" href="#jobs-parameters-as-files">Jobs parameters as files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#important-changes-in-soma-workflow-3-0">Important changes in Soma-Workflow 3.0</a><ul>
<li><a class="reference internal" href="#id1">Client-server communication</a></li>
<li><a class="reference internal" href="#python-2-and-python-3">Python 2 and Python 3</a><ul>
<li><a class="reference internal" href="#client-and-server-should-use-the-same-python-version">Client and server should use the same Python version</a></li>
<li><a class="reference internal" href="#playing-with-both-python-versions-at-the-same-time">Playing with both python versions at the same time</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="concepts.html"
                          title="previous chapter">Soma-workflow concepts</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="gui.html"
                          title="next chapter">Graphical User Interface</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/changes_swf3.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="gui.html" title="Graphical User Interface"
             >next</a> |</li>
        <li class="right" >
          <a href="concepts.html" title="Soma-workflow concepts"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">soma-workflow version 3.3 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Important changes in Soma-Workflow 3</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2011-2021 CEA, Neurospin, France, CATI, France.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.1.3.
    </div>
  </body>
</html>