<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Examples &#8212; soma-workflow version 3.3 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css?v=514cf933" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=eafc0fe6" />
    
    <script src="_static/documentation_options.js?v=3eb8911e"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="_static/icon_small.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="MPI workflow runner" href="MPI_workflow_runner.html" />
    <link rel="prev" title="Graphical User Interface" href="gui.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="MPI_workflow_runner.html" title="MPI workflow runner"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="gui.html" title="Graphical User Interface"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">soma-workflow version 3.3 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Examples</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="examples">
<span id="id1"></span><h1>Examples<a class="headerlink" href="#examples" title="Link to this heading">¶</a></h1>
<p>You will find here a set of examples. The objective is to illustrate how to
build simple to more complex workflows and submit them to soma-workflow.</p>
<dl class="simple">
<dt>The content of the jobs is not relevant here:</dt><dd><ul class="simple">
<li><p>The “sleep” command was used in the examples to stand for any job.</p></li>
<li><p>The “cp” command was used in the examples to stand for a job reading a file
and writing another file.</p></li>
</ul>
</dd>
</dl>
<p>However, <strong>the job examples were chosen to enable anyone to copy the examples and run them directly on his machine</strong>:</p>
<nav class="contents local" id="id2">
<p class="topic-title">Examples</p>
<ul class="simple">
<li><p><a class="reference internal" href="#simple-workflows" id="id5">Simple workflows</a></p>
<ul>
<li><p><a class="reference internal" href="#basic-example" id="id6">Basic example</a></p></li>
<li><p><a class="reference internal" href="#workflow-with-group" id="id7">Workflow with Group</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#go-further-with-the-client-server-mode" id="id8">Go further with the client-server mode</a></p></li>
<li><p><a class="reference internal" href="#workflows-with-filetransfer" id="id9">Workflows with FileTransfer</a></p>
<ul>
<li><p><a class="reference internal" href="#basic-file-transfer" id="id10">Basic file transfer</a></p></li>
<li><p><a class="reference internal" href="#another-basic-file-transfer" id="id11">Another basic file transfer</a></p></li>
<li><p><a class="reference internal" href="#working-directory-transfer" id="id12">Working directory transfer</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#workflows-with-sharedresourcepath" id="id13">Workflows with SharedResourcePath</a></p></li>
</ul>
</nav>
<section id="simple-workflows">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Simple workflows</a><a class="headerlink" href="#simple-workflows" title="Link to this heading">¶</a></h2>
<section id="basic-example">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Basic example</a><a class="headerlink" href="#basic-example" title="Link to this heading">¶</a></h3>
<figure class="align-default" id="id3">
<a class="reference internal image-reference" href="_images/simple_example.png"><img alt="_images/simple_example.png" src="_images/simple_example.png" style="width: 166.79999999999998px; height: 147.0px;" /></a>
<figcaption>
<p><span class="caption-text">Simple example: 4 jobs with dependencies.</span><a class="headerlink" href="#id3" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">soma_workflow.client</span> <span class="kn">import</span> <span class="n">Job</span><span class="p">,</span> <span class="n">Workflow</span><span class="p">,</span> <span class="n">Helper</span>


<span class="c1"># create the workflow:</span>

<span class="n">job_1</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sleep&quot;</span><span class="p">,</span> <span class="s2">&quot;60&quot;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;job 1&quot;</span><span class="p">)</span>
<span class="n">job_2</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sleep&quot;</span><span class="p">,</span> <span class="s2">&quot;60&quot;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;job 2&quot;</span><span class="p">)</span>
<span class="n">job_3</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sleep&quot;</span><span class="p">,</span> <span class="s2">&quot;60&quot;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;job 3&quot;</span><span class="p">)</span>
<span class="n">job_4</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sleep&quot;</span><span class="p">,</span> <span class="s2">&quot;60&quot;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;job 4&quot;</span><span class="p">)</span>

<span class="n">jobs</span> <span class="o">=</span> <span class="p">[</span><span class="n">job_1</span><span class="p">,</span> <span class="n">job_2</span><span class="p">,</span> <span class="n">job_3</span><span class="p">,</span> <span class="n">job_4</span><span class="p">]</span>
<span class="n">dependencies</span> <span class="o">=</span> <span class="p">[(</span><span class="n">job_1</span><span class="p">,</span> <span class="n">job_2</span><span class="p">),</span>
                <span class="p">(</span><span class="n">job_1</span><span class="p">,</span> <span class="n">job_3</span><span class="p">),</span>
                <span class="p">(</span><span class="n">job_2</span><span class="p">,</span> <span class="n">job_4</span><span class="p">),</span>
                <span class="p">(</span><span class="n">job_3</span><span class="p">,</span> <span class="n">job_4</span><span class="p">)]</span>

<span class="n">workflow</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">(</span><span class="n">jobs</span><span class="o">=</span><span class="n">jobs</span><span class="p">,</span>
                    <span class="n">dependencies</span><span class="o">=</span><span class="n">dependencies</span><span class="p">)</span>

<span class="c1"># save the workflow into a file</span>
<span class="n">Helper</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="s2">&quot;/tmp/workflow_example&quot;</span><span class="p">,</span> <span class="n">workflow</span><span class="p">)</span>
</pre></div>
</div>
<p>Run the Python script, then open the GUI (command: “soma_workflow_gui”).</p>
<dl class="simple">
<dt>In the GUI, you can now:</dt><dd><ul class="simple">
<li><p>Open the workflow file.</p></li>
<li><p>Submit the workflow to the computing resource of your choice.</p></li>
<li><p>Monitor the workflow execution:</p></li>
</ul>
</dd>
</dl>
<a class="reference internal image-reference" href="_images/simple_example_gui.png"><img alt="_images/simple_example_gui.png" src="_images/simple_example_gui.png" style="width: 848.4px; height: 509.4px;" /></a>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>The <a class="reference internal" href="workflow_creation.html#workflow-creation-api"><span class="std std-ref">workflow creation API</span></a> for a
full description of job and workflow options.</p>
</div>
</section>
<section id="workflow-with-group">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Workflow with Group</a><a class="headerlink" href="#workflow-with-group" title="Link to this heading">¶</a></h3>
<p>Creating groups can be useful to organize jobs within workflows for displaying
purpose. Groups do not have any impact on the execution of workflows.</p>
<figure class="align-default" id="id4">
<a class="reference internal image-reference" href="_images/simple_example_group.png"><img alt="_images/simple_example_group.png" src="_images/simple_example_group.png" style="width: 356.4px; height: 172.2px;" /></a>
<figcaption>
<p><span class="caption-text">Simple example with a group: 30 jobs are in the group “my 30 jobs”.</span><a class="headerlink" href="#id4" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">soma_workflow.client</span> <span class="kn">import</span> <span class="n">Job</span><span class="p">,</span> <span class="n">Workflow</span><span class="p">,</span> <span class="n">Group</span><span class="p">,</span> <span class="n">Helper</span>


<span class="c1"># create the workflow:</span>
<span class="n">jobs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">dependencies</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">group_elements</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">first_job</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sleep&quot;</span><span class="p">,</span> <span class="s2">&quot;10&quot;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;first job&quot;</span><span class="p">)</span>
<span class="n">last_job</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sleep&quot;</span><span class="p">,</span> <span class="s2">&quot;10&quot;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;last job&quot;</span><span class="p">)</span>

<span class="n">jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">first_job</span><span class="p">)</span>
<span class="n">jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">last_job</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">):</span>
  <span class="n">job</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sleep&quot;</span><span class="p">,</span> <span class="s2">&quot;60&quot;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;job &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

  <span class="n">jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>

  <span class="n">dependencies</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">first_job</span><span class="p">,</span> <span class="n">job</span><span class="p">))</span>
  <span class="n">dependencies</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">job</span><span class="p">,</span> <span class="n">last_job</span><span class="p">))</span>

  <span class="n">group_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>


<span class="n">thirty_jobs_group</span> <span class="o">=</span> <span class="n">Group</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="n">group_elements</span><span class="p">,</span>
                          <span class="n">name</span><span class="o">=</span><span class="s2">&quot;my 30 jobs&quot;</span><span class="p">)</span>

<span class="n">workflow</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">(</span><span class="n">jobs</span><span class="o">=</span><span class="n">jobs</span><span class="p">,</span>
                    <span class="n">dependencies</span><span class="o">=</span> <span class="n">dependencies</span><span class="p">,</span>
                    <span class="n">root_group</span><span class="o">=</span><span class="p">[</span><span class="n">first_job</span><span class="p">,</span> <span class="n">thirty_jobs_group</span><span class="p">,</span> <span class="n">last_job</span><span class="p">])</span>

<span class="c1"># save the workflow into a file</span>
<span class="n">Helper</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="s2">&quot;/tmp/workflow_example&quot;</span><span class="p">,</span> <span class="n">workflow</span><span class="p">)</span>
</pre></div>
</div>
<p>Run the Python script, then open the GUI (command: “soma_workflow_gui”) to
open, submit and monitor your workflow:</p>
<a class="reference internal image-reference" href="_images/simple_example_group_gui.png"><img alt="_images/simple_example_group_gui.png" src="_images/simple_example_group_gui.png" style="width: 808.8px; height: 507.59999999999997px;" /></a>
<p>The 30 jobs within the group can be extended (visible) or collapsed (hidden).</p>
</section>
</section>
<section id="go-further-with-the-client-server-mode">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Go further with the client-server mode</a><a class="headerlink" href="#go-further-with-the-client-server-mode" title="Link to this heading">¶</a></h2>
<p>When the computing resource you want to use is configured in the mono process
mode (this is the case if you use your multi core machine without special
configuration), all the workflows must run in a single session and the workflow
executions are stopped when this session is closed. In this case, it is thus
safer to save the workflows into files and submit them through the same GUI
you will use to monitor the execution (the workflows will be stopped
if you close the GUI).</p>
<p>The client-server mode is much more flexible. When you want to submit a workflow
to a computing resource configured in the client-server mode (remote cluster for
example), you can submit it directly to the computing resource in the Python
script instead of saving the workflow into a file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">soma_workflow.client</span> <span class="kn">import</span> <span class="n">WorkflowController</span>

<span class="c1"># workflow creation as described in the examples</span>
<span class="c1"># no need to save the workflow into a file</span>

<span class="c1"># submit the workflow to computing resource (configured in the client-server mode)</span>

<span class="n">controller</span> <span class="o">=</span> <span class="n">WorkflowController</span><span class="p">(</span><span class="s2">&quot;Titan&quot;</span><span class="p">,</span> <span class="n">login</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>

<span class="n">controller</span><span class="o">.</span><span class="n">submit_workflow</span><span class="p">(</span><span class="n">workflow</span><span class="o">=</span><span class="n">workflow</span><span class="p">,</span>
                           <span class="n">name</span><span class="o">=</span><span class="s2">&quot;simple example&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>You can now close and open the GUI at any time and even shut down you computer.
It will not interrupt the workflow execution.</strong></p>
</section>
<section id="workflows-with-filetransfer">
<span id="file-transfer-examples"></span><h2><a class="toc-backref" href="#id9" role="doc-backlink">Workflows with FileTransfer</a><a class="headerlink" href="#workflows-with-filetransfer" title="Link to this heading">¶</a></h2>
<p>The file transfers are optional. However, they can be useful if you use a remote
computing resource and there is no shared file system between
your machine and the computing resource (see <a class="reference internal" href="concepts.html#file-transfers-concept"><span class="std std-ref">File Transfer</span></a>).</p>
<p>These examples show how to create workflows managing file transfers.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>An easy way to deal with file transfers is to transfer a working
directory and work with relative paths (see <a class="reference internal" href="#working-directory-transfer-example"><span class="std std-ref">Another basic file transfer</span></a>).</p>
</div>
<section id="basic-file-transfer">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Basic file transfer</a><a class="headerlink" href="#basic-file-transfer" title="Link to this heading">¶</a></h3>
<p>To run this example, create first the file “/tmp/soma_workflow_examples/myfile”
with any content. It will stand for an input file to transfer.
Although the job is executed on the computing resource it appears that the
command is running on the local files, this is of course not the case. For another
example of file transfer without the gui go to the next section.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">soma_workflow.client</span> <span class="kn">import</span> <span class="n">Job</span><span class="p">,</span> <span class="n">Workflow</span><span class="p">,</span> <span class="n">WorkflowController</span><span class="p">,</span> <span class="n">FileTransfer</span>

<span class="c1"># FileTransfer creation for input files</span>
<span class="n">myfile</span> <span class="o">=</span> <span class="n">FileTransfer</span><span class="p">(</span><span class="n">is_input</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">client_path</span><span class="o">=</span><span class="s2">&quot;/tmp/soma_workflow_examples/myfile&quot;</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;myfile&quot;</span><span class="p">)</span>

<span class="c1"># FileTransfer creation for output files</span>
<span class="n">copy_of_myfile</span> <span class="o">=</span> <span class="n">FileTransfer</span><span class="p">(</span><span class="n">is_input</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="n">client_path</span><span class="o">=</span><span class="s2">&quot;/tmp/soma_workflow_examples/copy_of_myfile&quot;</span><span class="p">,</span>
                              <span class="n">name</span><span class="o">=</span><span class="s2">&quot;copy of my file&quot;</span><span class="p">)</span>

<span class="c1"># Job and Workflow</span>
<span class="n">copy_job</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cp&quot;</span><span class="p">,</span> <span class="n">myfile</span><span class="p">,</span> <span class="n">copy_of_myfile</span><span class="p">],</span>
              <span class="n">name</span><span class="o">=</span><span class="s2">&quot;copy&quot;</span><span class="p">,</span>
              <span class="n">referenced_input_files</span><span class="o">=</span><span class="p">[</span><span class="n">myfile</span><span class="p">],</span>
              <span class="n">referenced_output_files</span><span class="o">=</span><span class="p">[</span><span class="n">copy_of_myfile</span><span class="p">])</span>

<span class="n">workflow</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">(</span><span class="n">jobs</span><span class="o">=</span><span class="p">[</span><span class="n">copy_job</span><span class="p">],</span>
                    <span class="n">dependencies</span><span class="o">=</span><span class="p">[])</span>



<span class="c1"># submit the workflow</span>
<span class="n">controller</span> <span class="o">=</span> <span class="n">WorkflowController</span><span class="p">(</span><span class="s2">&quot;Titan&quot;</span><span class="p">,</span> <span class="n">login</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>

<span class="n">controller</span><span class="o">.</span><span class="n">submit_workflow</span><span class="p">(</span><span class="n">workflow</span><span class="o">=</span><span class="n">workflow</span><span class="p">,</span>
                          <span class="n">name</span><span class="o">=</span><span class="s2">&quot;simple transfer&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Run the Python script and open the GUI:</p>
<a class="reference internal image-reference" href="_images/file_transfer_example_gui.png"><img alt="_images/file_transfer_example_gui.png" src="_images/file_transfer_example_gui.png" style="width: 754.8px; height: 507.59999999999997px;" /></a>
<p>Transfer the input files using the “Transfer Input Files” button:</p>
<a class="reference internal image-reference" href="_images/file_transfer_example_gui_1.png"><img alt="_images/file_transfer_example_gui_1.png" src="_images/file_transfer_example_gui_1.png" style="width: 514.4px; height: 187.20000000000002px;" /></a>
<p>The job will start as soon as the transfers ended:</p>
<a class="reference internal image-reference" href="_images/file_transfer_example_gui_2.png"><img alt="_images/file_transfer_example_gui_2.png" src="_images/file_transfer_example_gui_2.png" style="width: 514.4px; height: 185.60000000000002px;" /></a>
<p>When the workflow is done, transfer the output files using the
“Transfer Output Files” button:</p>
<a class="reference internal image-reference" href="_images/file_transfer_example_gui_3.png"><img alt="_images/file_transfer_example_gui_3.png" src="_images/file_transfer_example_gui_3.png" style="width: 514.4px; height: 186.4px;" /></a>
<p>The progression and the end of the transfer are visible in the GUI.</p>
<a class="reference internal image-reference" href="_images/file_transfer_example_gui_4.png"><img alt="_images/file_transfer_example_gui_4.png" src="_images/file_transfer_example_gui_4.png" style="width: 513.6px; height: 186.4px;" /></a>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="status_list.html#file-transfer-status"><span class="std std-ref">File Transfer status</span></a></p>
</div>
</section>
<section id="another-basic-file-transfer">
<span id="working-directory-transfer-example"></span><h3><a class="toc-backref" href="#id11" role="doc-backlink">Another basic file transfer</a><a class="headerlink" href="#another-basic-file-transfer" title="Link to this heading">¶</a></h3>
<p>For this example we use a dummy program that will create a file on the computing resource:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;a very original message: Hello world!&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>it takes, as input, the name of the file that it creates.</p>
<p>Here is the program:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">soma_workflow.client</span> <span class="kn">import</span> <span class="n">Job</span><span class="p">,</span> <span class="n">Workflow</span><span class="p">,</span> <span class="n">WorkflowController</span><span class="p">,</span> <span class="n">Helper</span><span class="p">,</span> <span class="n">FileTransfer</span>

<span class="n">controller</span> <span class="o">=</span> <span class="n">WorkflowController</span><span class="p">(</span><span class="s2">&quot;Gabriel&quot;</span><span class="p">,</span> <span class="s2">&quot;mb253889&quot;</span><span class="p">)</span>

<span class="c1"># FileTransfer creation for input files</span>
<span class="n">file1</span> <span class="o">=</span> <span class="n">FileTransfer</span><span class="p">(</span><span class="n">is_input</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">client_path</span><span class="o">=</span><span class="s2">&quot;/home/mb253889/create_file.py&quot;</span><span class="p">,</span>
                     <span class="n">name</span><span class="o">=</span><span class="s2">&quot;script&quot;</span><span class="p">)</span>

<span class="n">file2</span> <span class="o">=</span> <span class="n">FileTransfer</span><span class="p">(</span><span class="n">is_input</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">client_path</span><span class="o">=</span><span class="s2">&quot;/home/mb253889/output_file&quot;</span><span class="p">,</span>
                     <span class="n">name</span><span class="o">=</span><span class="s2">&quot;file created on the server&quot;</span><span class="p">)</span>

<span class="c1"># Job and Workflow</span>
<span class="n">run_script</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">,</span> <span class="n">file1</span><span class="p">,</span> <span class="n">file2</span><span class="p">],</span>
                 <span class="n">name</span><span class="o">=</span><span class="s2">&quot;copy&quot;</span><span class="p">,</span>
                 <span class="n">referenced_input_files</span><span class="o">=</span><span class="p">[</span><span class="n">file1</span><span class="p">],</span>
                 <span class="n">referenced_output_files</span><span class="o">=</span><span class="p">[</span><span class="n">file2</span><span class="p">])</span>

<span class="n">workflow</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">(</span><span class="n">jobs</span><span class="o">=</span><span class="p">[</span><span class="n">run_script</span><span class="p">],</span>
                    <span class="n">dependencies</span><span class="o">=</span><span class="p">[])</span>

<span class="n">workflow_id</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">submit_workflow</span><span class="p">(</span><span class="n">workflow</span><span class="o">=</span><span class="n">workflow</span><span class="p">,</span>
                                       <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Simple transfer&quot;</span><span class="p">)</span>

<span class="c1"># You may use the gui or manually transfer the files:</span>
<span class="n">manual</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">if</span> <span class="n">manual</span><span class="p">:</span>
    <span class="n">Helper</span><span class="o">.</span><span class="n">transfer_input_files</span><span class="p">(</span><span class="n">workflow_id</span><span class="p">,</span> <span class="n">controller</span><span class="p">)</span>
    <span class="n">Helper</span><span class="o">.</span><span class="n">wait_workflow</span><span class="p">(</span><span class="n">workflow_id</span><span class="p">,</span> <span class="n">controller</span><span class="p">)</span>
    <span class="n">Helper</span><span class="o">.</span><span class="n">transfer_output_files</span><span class="p">(</span><span class="n">workflow_id</span><span class="p">,</span> <span class="n">controller</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Finished !!!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Easy, isn’t it?</p>
</section>
<section id="working-directory-transfer">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">Working directory transfer</a><a class="headerlink" href="#working-directory-transfer" title="Link to this heading">¶</a></h3>
<p>An easy way to work with file transfers is to transfer a working directory
containing all the files you need and then use only relative file paths in your
jobs.</p>
<p>In this example, the working directory contains 2 files: myfile1 and myfile2.
The workflow contains 2 jobs which will modify the working directory.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">soma_workflow.client</span> <span class="kn">import</span> <span class="n">Job</span><span class="p">,</span> <span class="n">Workflow</span><span class="p">,</span> <span class="n">WorkflowController</span><span class="p">,</span> <span class="n">FileTransfer</span>

<span class="c1"># Creation of the FileTransfer object to transfer the working directory</span>
<span class="n">my_working_directory</span> <span class="o">=</span> <span class="n">FileTransfer</span><span class="p">(</span><span class="n">is_input</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                    <span class="n">client_path</span><span class="o">=</span><span class="s2">&quot;/tmp/my_working_directory&quot;</span><span class="p">,</span>
                                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;working directory&quot;</span><span class="p">)</span>

<span class="c1"># Jobs and Workflow</span>
<span class="c1"># Do not forget to set the working_directory argument when creating the jobs</span>
<span class="n">job1</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cp&quot;</span><span class="p">,</span> <span class="s2">&quot;myfile1&quot;</span> <span class="p">,</span> <span class="s2">&quot;copy_of_myfile1&quot;</span><span class="p">],</span>
           <span class="n">name</span><span class="o">=</span><span class="s2">&quot;job1&quot;</span><span class="p">,</span>
           <span class="n">referenced_input_files</span><span class="o">=</span><span class="p">[</span><span class="n">my_working_directory</span><span class="p">],</span>
           <span class="n">referenced_output_files</span><span class="o">=</span><span class="p">[</span><span class="n">my_working_directory</span><span class="p">],</span>
           <span class="n">working_directory</span><span class="o">=</span><span class="n">my_working_directory</span><span class="p">)</span>

<span class="n">job2</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cp&quot;</span><span class="p">,</span> <span class="s2">&quot;myfile2&quot;</span> <span class="p">,</span> <span class="s2">&quot;copy_of_myfile2&quot;</span><span class="p">],</span>
           <span class="n">name</span><span class="o">=</span><span class="s2">&quot;job2&quot;</span><span class="p">,</span>
           <span class="n">referenced_input_files</span><span class="o">=</span><span class="p">[</span><span class="n">my_working_directory</span><span class="p">],</span>
           <span class="n">referenced_output_files</span><span class="o">=</span><span class="p">[</span><span class="n">my_working_directory</span><span class="p">],</span>
           <span class="n">working_directory</span><span class="o">=</span><span class="n">my_working_directory</span><span class="p">)</span>

<span class="n">workflow</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">(</span><span class="n">jobs</span><span class="o">=</span><span class="p">[</span><span class="n">job1</span><span class="p">,</span> <span class="n">job2</span><span class="p">],</span>
                    <span class="n">dependencies</span><span class="o">=</span><span class="p">[])</span>


<span class="c1"># submit the workflow</span>
<span class="n">controller</span> <span class="o">=</span> <span class="n">WorkflowController</span><span class="p">(</span><span class="s2">&quot;Titan&quot;</span><span class="p">,</span> <span class="n">login</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>

<span class="n">controller</span><span class="o">.</span><span class="n">submit_workflow</span><span class="p">(</span><span class="n">workflow</span><span class="o">=</span><span class="n">workflow</span><span class="p">,</span>
                           <span class="n">name</span><span class="o">=</span><span class="s2">&quot;working directory transfer example&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Run the Python script and monitor the execution of the workflow using
the GUI (soma_workflow_gui command):</p>
<a class="reference internal image-reference" href="_images/wd_transfer_example_gui.png"><img alt="_images/wd_transfer_example_gui.png" src="_images/wd_transfer_example_gui.png" style="width: 657.6px; height: 477.6px;" /></a>
<p>Transfer the working directory to the computing resource using the “Transfer
Input Files” button and wait for the jobs to execute:</p>
<a class="reference internal image-reference" href="_images/wd_transfer_example_gui_1.png"><img alt="_images/wd_transfer_example_gui_1.png" src="_images/wd_transfer_example_gui_1.png" style="width: 656.0px; height: 481.6px;" /></a>
<p>Transfer the working directory back using the “Transfer Output Files” button:</p>
<a class="reference internal image-reference" href="_images/wd_transfer_example_gui_2.png"><img alt="_images/wd_transfer_example_gui_2.png" src="_images/wd_transfer_example_gui_2.png" style="width: 660.0px; height: 482.40000000000003px;" /></a>
<p>The working directory on your machine should now contains the files: myfile1, myfile2,
copy_of_myfile1 and copy_of_myfile2.</p>
</section>
</section>
<section id="workflows-with-sharedresourcepath">
<span id="shared-resource-path-examples"></span><h2><a class="toc-backref" href="#id13" role="doc-backlink">Workflows with SharedResourcePath</a><a class="headerlink" href="#workflows-with-sharedresourcepath" title="Link to this heading">¶</a></h2>
<p>As file transfers, shared resource paths are optional but can be useful if
you use a remote computing resource and there is no shared file system between
your machine and the computing resource.</p>
<p>SharedResourcePath are convenient when a copy of the data already exist on the
computing resource file system (see <a class="reference internal" href="concepts.html#shared-resource-path-concept"><span class="std std-ref">Shared Resource Path</span></a>).</p>
<p>To run this example:</p>
<ol class="arabic simple">
<li><p>Create the directory “/tmp/soma_workflow_examples” and the file “/tmp/soma_workflow_examples/myfile” with any content you like. This directory will stand for the data you want to process.</p></li>
<li><p>Create the same data at any location on the computing resource file system, for example “$HOME/soma_workflow_examples/myfile”. It will stand for the copy of the data on the computing resource.</p></li>
<li><p>On the computing resource file system, create a translation file at the location “$HOME/translation_example” for example. It will contain, the correspondences between identifiers and path:</p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_example_dir</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">toto</span><span class="o">/</span><span class="n">soma_workflow_examples</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>Still on the computing resource side, register the translation path in the configuration file under the namespace “MyApp” (see <a class="reference internal" href="install_config.html#conf-server-option"><span class="std std-ref">Configuration items optional on the server side:</span></a>):</p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PATH_TRANSLATION_FILES</span> <span class="o">=</span> <span class="n">MyApp</span><span class="p">{</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">toto</span><span class="o">/</span><span class="n">translation_example</span><span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>Run the script to create and submit the workflow:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">soma_workflow.client</span> <span class="kn">import</span> <span class="n">Job</span><span class="p">,</span> <span class="n">Workflow</span><span class="p">,</span> <span class="n">WorkflowController</span><span class="p">,</span> <span class="n">SharedResourcePath</span><span class="p">,</span> <span class="n">FileTransfer</span>

<span class="c1"># SharedResourcePath creation for the input file.</span>
<span class="c1"># The input file is read direclty in the data directory located on the</span>
<span class="c1"># the computing resource side.</span>
<span class="n">myfile</span> <span class="o">=</span> <span class="n">SharedResourcePath</span><span class="p">(</span><span class="n">relative_path</span><span class="o">=</span><span class="s2">&quot;myfile&quot;</span><span class="p">,</span>
                            <span class="n">namespace</span><span class="o">=</span><span class="s2">&quot;MyApp&quot;</span><span class="p">,</span>
                            <span class="n">uuid</span><span class="o">=</span><span class="s2">&quot;my_example_dir&quot;</span><span class="p">)</span>

<span class="c1"># FileTransfer creation for the output file.</span>
<span class="c1"># That way the output file will not be written in the data directory</span>
<span class="c1"># located on the computing resource file system.</span>
<span class="n">copy_of_myfile</span> <span class="o">=</span>  <span class="n">FileTransfer</span><span class="p">(</span><span class="n">is_input</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                               <span class="n">client_path</span><span class="o">=</span><span class="s2">&quot;/tmp/soma_workflow_examples/copy_of_myfile&quot;</span><span class="p">,</span>
                               <span class="n">name</span><span class="o">=</span><span class="s2">&quot;copy of my file&quot;</span><span class="p">)</span>

<span class="c1"># Job and Workflow creation</span>
<span class="n">copy_job</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cp&quot;</span><span class="p">,</span> <span class="n">myfile</span><span class="p">,</span> <span class="n">copy_of_myfile</span><span class="p">],</span>
              <span class="n">name</span><span class="o">=</span><span class="s2">&quot;copy&quot;</span><span class="p">,</span>
              <span class="n">referenced_input_files</span><span class="o">=</span><span class="p">[],</span>
              <span class="n">referenced_output_files</span><span class="o">=</span><span class="p">[</span><span class="n">copy_of_myfile</span><span class="p">])</span>

<span class="n">workflow</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">(</span><span class="n">jobs</span><span class="o">=</span><span class="p">[</span><span class="n">copy_job</span><span class="p">],</span>
                    <span class="n">dependencies</span><span class="o">=</span><span class="p">[])</span>

<span class="c1"># workflow submission</span>
<span class="n">controller</span> <span class="o">=</span> <span class="n">WorkflowController</span><span class="p">(</span><span class="s2">&quot;DSV_cluster&quot;</span><span class="p">,</span> <span class="n">login</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>

<span class="n">controller</span><span class="o">.</span><span class="n">submit_workflow</span><span class="p">(</span><span class="n">workflow</span><span class="o">=</span><span class="n">workflow</span><span class="p">,</span>
                           <span class="n">name</span><span class="o">=</span><span class="s2">&quot;shared resource path example&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Open the GUI to monitor the workflow. Once the execution is done, transfer back
the output files.</p>
<p>The data directory “/tmp/soma_workflow_examples/” on your machine  should now
contains the file copy_of_myfile.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo_white_small.png" alt="Logo"/>
            </a></p>
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Examples</a><ul>
<li><a class="reference internal" href="#simple-workflows">Simple workflows</a><ul>
<li><a class="reference internal" href="#basic-example">Basic example</a></li>
<li><a class="reference internal" href="#workflow-with-group">Workflow with Group</a></li>
</ul>
</li>
<li><a class="reference internal" href="#go-further-with-the-client-server-mode">Go further with the client-server mode</a></li>
<li><a class="reference internal" href="#workflows-with-filetransfer">Workflows with FileTransfer</a><ul>
<li><a class="reference internal" href="#basic-file-transfer">Basic file transfer</a></li>
<li><a class="reference internal" href="#another-basic-file-transfer">Another basic file transfer</a></li>
<li><a class="reference internal" href="#working-directory-transfer">Working directory transfer</a></li>
</ul>
</li>
<li><a class="reference internal" href="#workflows-with-sharedresourcepath">Workflows with SharedResourcePath</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="gui.html"
                          title="previous chapter">Graphical User Interface</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="MPI_workflow_runner.html"
                          title="next chapter">MPI workflow runner</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/examples.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="MPI_workflow_runner.html" title="MPI workflow runner"
             >next</a> |</li>
        <li class="right" >
          <a href="gui.html" title="Graphical User Interface"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">soma-workflow version 3.3 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Examples</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2011-2021 CEA, Neurospin, France, CATI, France.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>